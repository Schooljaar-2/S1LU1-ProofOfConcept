<div class="container pt-2 pb-5">
    <!-- Removed page title for tighter layout -->
    <form class="bg-dark p-3 rounded shadow mb-3 w-100" style="margin-left: 0;">
        <div class="row g-3 align-items-end w-100">
            <div class="col-12 col-md-3">
                <label for="searchTitle" class="form-label text-light">Title</label>
                <input type="text" class="form-control" id="searchTitle" name="title" placeholder="Search by title" value="{{filters.title}}">
            </div>
            <div class="col-12 col-md-3">
                <label for="searchCategory" class="form-label text-light">Category</label>
                <select class="form-select" id="searchCategory" name="category">
                    <option value="">All Categories</option>
                    {{#each categories}}
                    <option value="{{this.name}}" {{#ifCond ../filters.category this.name}}selected{{/ifCond}}>{{this.name}}</option>
                    {{/each}}
                </select>
            </div>
            <div class="col-12 col-md-2">
                <label for="searchRating" class="form-label text-light">Rating</label>
                <select class="form-select" id="searchRating" name="rating">
                    <option value="">All Ratings</option>
                    {{#each ratings}}
                    <option value="{{this.rating}}" {{#ifCond ../filters.rating this.rating}}selected{{/ifCond}}>{{this.rating}}</option>
                    {{/each}}
                </select>
            </div>
            <div class="col-12 col-md-4 d-flex align-items-end gap-2 justify-content-end">
                <div class="flex-grow-1">
                    <label for="searchSort" class="form-label text-light">Sort By</label>
                    <select class="form-select" id="searchSort" name="sort">
                        <option value="0" {{#ifCond filters.sort "0"}}selected{{/ifCond}}>Title (A-Z)</option>
                        <option value="1" {{#ifCond filters.sort "1"}}selected{{/ifCond}}>Title (Z-A)</option>
                        <option value="2" {{#ifCond filters.sort "2"}}selected{{/ifCond}}>Release Year (Ascending)</option>
                        <option value="3" {{#ifCond filters.sort "3"}}selected{{/ifCond}}>Release Year (Descending)</option>
                        <option value="4" {{#ifCond filters.sort "4"}}selected{{/ifCond}}>Rental Rate (Ascending)</option>
                        <option value="5" {{#ifCond filters.sort "5"}}selected{{/ifCond}}>Rental Rate (Descending)</option>
                        <option value="6" {{#ifCond filters.sort "6"}}selected{{/ifCond}}>Movie Length (Ascending)</option>
                        <option value="7" {{#ifCond filters.sort "7"}}selected{{/ifCond}}>Movie Length (Descending)</option>
                    </select>
                        <!-- Hidden input for pagination, controlled by Prev/Next buttons -->
                        <input type="hidden" id="pageAction" name="pagination" value="{{filters.pagination}}">
                </div>
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-warning fw-bold">Apply</button>
                    <button type="reset" class="btn btn-secondary fw-bold">Clear</button>
                </div>
            </div>
        </div>
    </form>

    <!-- Movies Table: Shows up to 10 movies -->
    <table class="table table-dark table-hover align-middle mt-2" style="background-color: #181818; color: #fff;">
        <thead class="table-dark">
            <tr>
                <th scope="col" class="text-white">Poster</th>
                <th scope="col" class="text-white">Title</th>
                <th scope="col" class="text-white">Year</th>
                <th scope="col" class="text-white">Length</th>
                <th scope="col" class="text-white">Rating</th>
                <th scope="col" class="text-white">Categories</th>
                <th scope="col" class="text-white"></th>
            </tr>
        </thead>
        <tbody>
            {{#each movies}}
                <tr>
                    <td style="width: 80px;">
                        {{#if image_url}}
                            {{#if image_url.length}}
                                <img src="{{image_url}}" alt="Poster" class="img-fluid rounded" style="max-width: 60px; max-height: 60px;">
                            {{else}}
                                <img src="/images/imageNotFound.png" alt="No Image" class="img-fluid rounded" style="max-width: 60px; max-height: 60px;">
                            {{/if}}
                        {{else}}
                            <img src="/images/imageNotFound.png" alt="No Image" class="img-fluid rounded" style="max-width: 60px; max-height: 60px;">
                        {{/if}}
                    </td>
                    <td class="text-white"><strong>{{title}}</strong></td>
                    <td class="text-white">{{release_year}}</td>
                    <td class="text-white">{{length}} min</td>
                    <td class="text-white">{{rating}}</td>
                    <td class="text-white">{{categories}}</td>
                    <td class="text-end">
                        <a href="/movies/{{film_id}}" class="btn btn-warning btn-sm">See more</a>
                    </td>
                </tr>
            {{/each}}
        </tbody>
        </table>

                <!-- Pagination Buttons -->
                        <div class="d-flex justify-content-center align-items-center gap-2 mt-3" style="margin-bottom: 20px;">
                              <button type="button" class="btn btn-outline-warning fw-bold" id="prev10Btn">Prev-10</button>
                              <button type="button" class="btn btn-outline-warning fw-bold" id="prev5Btn">Prev-5</button>
                              <button type="button" class="btn btn-outline-warning fw-bold" id="prevBtn">Prev</button>
                              <span class="mx-1 text-warning">--=--</span>
                              <button type="button" class="btn btn-outline-warning fw-bold" id="nextBtn">Next</button>
                              <button type="button" class="btn btn-outline-warning fw-bold" id="next5Btn">Next+5</button>
                              <button type="button" class="btn btn-outline-warning fw-bold" id="next10Btn">Next+10</button>
                            </div>
                            <div class="d-flex justify-content-center mt-2 mb-4">
                                <span class="text-light fs-5" id="movieRangeText"></span>
                </div>
                <script>
                (function() {
                    var form = document.querySelector('form');
                    var hidden = document.getElementById('pageAction');
                    var total = parseInt('{{totalCount}}', 10);
                    var current = parseInt(hidden.value || '10', 10);
                    function setAndSubmit(newVal) {
                        if (newVal < 0) newVal = 0;
                        if (newVal > total) newVal = total;
                        hidden.value = newVal;
                        form.submit();
                    }

                    // On form submit (Apply), reset pagination to 0
                    form.addEventListener('submit', function(e) {
                        hidden.value = 0;
                    });
                    document.getElementById('prev10Btn').onclick = function() {
                        setAndSubmit(current - 10);
                    };
                    document.getElementById('prev5Btn').onclick = function() {
                        setAndSubmit(current - 5);
                    };
                    document.getElementById('prevBtn').onclick = function() {
                        setAndSubmit(current - 1);
                    };
                    document.getElementById('nextBtn').onclick = function() {
                        setAndSubmit(current + 1);
                    };
                    document.getElementById('next5Btn').onclick = function() {
                        setAndSubmit(current + 5);
                    };
                    document.getElementById('next10Btn').onclick = function() {
                        setAndSubmit(current + 10);
                    };

                    // Calculate and display the range text
                    function updateRangeText() {
                        var perPage = 10;
                        var pageCount = current + 1; // treat pagination as 1-based for display
                        var start = (pageCount * perPage) - perPage + 1;
                        var end = pageCount * perPage;
                        if (start < 1) start = 1;
                        if (end > total) end = total;
                        if (start > end) start = end;
                        document.getElementById('movieRangeText').textContent = `Showing movies ${start} - ${end} out of ${total}`;
                    }
                    updateRangeText();
                })();
                document.querySelector('.btn-secondary').addEventListener('click', function(e) {
                    e.preventDefault();
                    var form = document.querySelector('form');
                    // Explicitly clear all relevant fields
                    form.querySelector('[name="title"]').value = '';
                    form.querySelector('[name="category"]').value = '';
                    form.querySelector('[name="rating"]').value = '';
                    form.querySelector('[name="sort"]').value = '';
                var hidden = document.getElementById('pageAction');
                if (hidden) hidden.value = '0';
                    form.submit();
                });
                </script>
            </div>
        </div>

</div>